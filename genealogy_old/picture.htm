<%[@ IncludeFile "Code/Util.vbs" ]%>
<%[@ IncludeFile "Code/Lang.vbs" ]%>
<%[



If p.References.Count = 0 Or CustomTag(p, "_Exclude") = "Y" Then Report.AbortPage

strTitle = Dic("Picture") &" " & Util.IfElse(Session("fUsePictureId") = True,p.ID,StrFormatText(p, StrParseText(Trim(p.Name), True)))

]%><?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns='http://www.w3.org/1999/xhtml'>
<head>
<meta http-equiv="Content-Language" content="@[WriteHtmlLang]@"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>@[ Report.WriteText Session("Title") ]@</title>
<meta name="description" content="@[WriteMetaDescriptionReport]@" />
<meta name="keywords" content="@[WriteMetaKeywordsReport]@" />
<link rel="stylesheet" href="style.css" type="text/css"/>
<base target="detail"/>
<script src="scripts/script.js" type="text/javascript"></script>
@[GoogleAnalytics]@
</head>
<body class="gno-detail" onload="javascript:PageInit(@[Report.Write Util.IfElse(Session("ForceFrames"), "true", "false")]@, '@[Report.Write Util.JavaScriptEncode(strTitle)]@');">
<%[if session("fUseCurvyBoxes") then CurvyBoxOpen()]%>
<div class='floatright'>
<%[
	g_ichNotesStart = Report.BufferLength
	WriteHtmlButtonToggle("Notes")
	ichNotesEnd = Report.BufferLength

	g_ichReferencesStart = Report.BufferLength
	WriteHtmlButtonToggle("OtherDetails")
	ichReferencesEnd = Report.BufferLength

	WriteHtmlButtonToggle("HidePopUp")
]%>
</div>
<h1>@[ Report.Write strTitle ]@</h1>

<%[
Dim strDimension, c, strName, strMap
	strMap = CustomTag(p, "_AreaMap")
	If strMap = "" Then
		Report.WriteLn "<div class='floatright'>"
		strDimension = p.PictureDimension(Session("cxPictureSizeLarge") & "x" & Session("cyPictureSizeLarge"))
		WriteHtmlPicture p, Util.GetWidth(strDimension), Util.GetHeight(strDimension), Session("cxyPicturePadding"), "right", Session("cxPictureSizeLarge"), Session("cyPictureSizeLarge")
		Report.WriteLn "</div>"
	End If
	strName = Util.IfElse(g_fUse_PictureId,Trim(p.Name),"")
	If strMap <> "" Then
		Report.Write "<div width='95%' style='text-align:center; overflow:auto;'>"
		Report.WriteFormattedLn "<img src='{}' class='pic' usemap='#map'/>", p.Path.report
		Report.WriteFormattedLn "<map name='map'>{}</map>", strMap
		Report.WriteFormattedLn "<div class='note'>{}</div>", Dic("PictureMapHint")
		Report.WriteLn "</div>"
	End If
	Report.WritePhraseDic "PhPictureDetails", Util.IfElse(Session("fHidePictureName"), "", strName), p.Date.ToStringNarrative, StrHtmlHyperlink(p.Place), ""
	WriteHtmlFootnoteRef p.Source
	If Not Util.IsNothing(p.Source) Then g_collFootnotes.AddUnique(p.Source)
	
	WriteHtmlExtraNarrative p

	WriteHtmlAdditionalInformation p
	WriteHtmlAnnotation p, Dic("AnnotationPicture"), p.Comment
	Set c = p.Cache
	If Session("fShowTechnicalData") Then WriteHtmlAnnotation p, Dic("AnnotationPictureTechnical"), Util.FormatPhrase(Dic("PhPictureTechnical"), c.Dimension, c.Megapixels, c.FileSizeKB, c.Dpi, c.Bpp, p.Path.relative)
	WriteHtmlAllFootnotes p.Sources, True
	WriteHtmlReferences p, False
	Report.Writeln "<div class='clear'></div>"

' remove any unecessary items (reverse order to avoid invalidating buffer pointers)
If g_ichReferencesStart >= 0 Then
	' We have no place references, so remove the "Show All References | Hide All References"
	Report.BufferRemoveAt g_ichReferencesStart, ichReferencesEnd
End If
If (g_ichNotesStart >= 0) Then
	' We have no annotations, so remove the "Show All Notes | Hide All Notes"
	Report.BufferRemoveAt g_ichNotesStart, ichNotesEnd
End If
]%>
<div class='clear'></div>
<%[ WriteHtmlFramesetSafeguard("Places") ]%>
<%[if session("fUseCurvyBoxes") then CurvyBoxClose()]%>
</body>

</html>